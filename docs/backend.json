{
  "entities": {
    "Restaurant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Restaurant",
      "type": "object",
      "description": "Represents a restaurant with its details.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Restaurant entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the restaurant."
        },
        "cuisine": {
          "type": "string",
          "description": "Type of cuisine offered by the restaurant."
        },
        "address": {
          "type": "string",
          "description": "Address of the restaurant."
        },
        "latitude": {
          "type": "number",
          "description": "Latitude coordinate of the restaurant's location."
        },
        "longitude": {
          "type": "number",
          "description": "Longitude coordinate of the restaurant's location."
        },
        "menuItemIds": {
          "type": "array",
          "description": "References to MenuItems. (Relationship: Restaurant 1:N MenuItem)",
          "items": {
            "type": "string"
          }
        },
        "tableIds": {
          "type": "array",
          "description": "References to Tables. (Relationship: Restaurant 1:N Table)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "cuisine",
        "address",
        "latitude",
        "longitude"
      ]
    },
    "MenuItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MenuItem",
      "type": "object",
      "description": "Represents an item on a restaurant's menu.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MenuItem entity."
        },
        "restaurantId": {
          "type": "string",
          "description": "Reference to Restaurant. (Relationship: Restaurant 1:N MenuItem)"
        },
        "name": {
          "type": "string",
          "description": "Name of the menu item."
        },
        "description": {
          "type": "string",
          "description": "Description of the menu item."
        },
        "price": {
          "type": "number",
          "description": "Price of the menu item."
        }
      },
      "required": [
        "id",
        "restaurantId",
        "name",
        "description",
        "price"
      ]
    },
    "Table": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Table",
      "type": "object",
      "description": "Represents a table in a restaurant.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Table entity."
        },
        "restaurantId": {
          "type": "string",
          "description": "Reference to Restaurant. (Relationship: Restaurant 1:N Table)"
        },
        "capacity": {
          "type": "number",
          "description": "Maximum number of people that can be seated at the table."
        },
        "isAvailable": {
          "type": "boolean",
          "description": "Indicates whether the table is currently available."
        }
      },
      "required": [
        "id",
        "restaurantId",
        "capacity",
        "isAvailable"
      ]
    },
    "Reservation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reservation",
      "type": "object",
      "description": "Represents a table reservation made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Reservation entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Reservation)"
        },
        "tableId": {
          "type": "string",
          "description": "Reference to Table. (Relationship: Table 1:N Reservation)"
        },
        "reservationTime": {
          "type": "string",
          "description": "The date and time of the reservation.",
          "format": "date-time"
        },
        "partySize": {
          "type": "number",
          "description": "The number of people in the party."
        },
        "qrCode": {
          "type": "string",
          "description": "QR code for the reservation."
        }
      },
      "required": [
        "id",
        "userId",
        "tableId",
        "reservationTime",
        "partySize",
        "qrCode"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the DineEase application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "Username of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "reservationIds": {
          "type": "array",
          "description": "References to Reservations. (Relationship: User 1:N Reservation)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/restaurants/{restaurantId}",
        "definition": {
          "entityName": "Restaurant",
          "schema": {
            "$ref": "#/backend/entities/Restaurant"
          },
          "description": "Stores restaurant details. Includes basic information accessible to all users for restaurant discovery.",
          "params": [
            {
              "name": "restaurantId",
              "description": "Unique identifier for the restaurant."
            }
          ]
        }
      },
      {
        "path": "/restaurants/{restaurantId}/menuItems/{menuItemId}",
        "definition": {
          "entityName": "MenuItem",
          "schema": {
            "$ref": "#/backend/entities/MenuItem"
          },
          "description": "Stores menu items for each restaurant. Includes denormalized 'restaurantId' for authorization independence.",
          "params": [
            {
              "name": "restaurantId",
              "description": "Unique identifier for the restaurant."
            },
            {
              "name": "menuItemId",
              "description": "Unique identifier for the menu item."
            }
          ]
        }
      },
      {
        "path": "/restaurants/{restaurantId}/tables/{tableId}",
        "definition": {
          "entityName": "Table",
          "schema": {
            "$ref": "#/backend/entities/Table"
          },
          "description": "Stores table information for each restaurant. Includes denormalized 'restaurantId' for authorization independence.",
          "params": [
            {
              "name": "restaurantId",
              "description": "Unique identifier for the restaurant."
            },
            {
              "name": "tableId",
              "description": "Unique identifier for the table."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Accessible only to the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user (equal to request.auth.uid)."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/reservations/{reservationId}",
        "definition": {
          "entityName": "Reservation",
          "schema": {
            "$ref": "#/backend/entities/Reservation"
          },
          "description": "Stores reservation details for each user. Includes 'userId' to ensure only the authenticated user can access their own reservations.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user (equal to request.auth.uid)."
            },
            {
              "name": "reservationId",
              "description": "Unique identifier for the reservation."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the DineEase application's core features, emphasizing security, scalability, and ease of debugging. It leverages path-based ownership for user-specific data and denormalization to ensure authorization independence. This structure facilitates straightforward security rules and efficient data retrieval.\n\nThe `/restaurants/{restaurantId}` collection stores restaurant details. Subcollections `/restaurants/{restaurantId}/menuItems/{menuItemId}` and `/restaurants/{restaurantId}/tables/{tableId}` store the restaurant's menu items and tables, respectively. This approach leverages the hierarchical data model in Firestore to represent 1:N relationships efficiently.\n\nUser-related data, such as reservations, are stored under `/users/{userId}/reservations/{reservationId}`. This path-based ownership ensures that only the authenticated user can access their reservations. This provides a clear ownership model and simplifies security rules. This approach is very secure.\n\n**Authorization Independence (CRITICAL):** All data access is governed by `request.auth.uid`, with no reliance on `get()` calls in security rules. Data like `restaurantId` is duplicated in subcollections like `/restaurants/{restaurantId}/menuItems/{menuItemId}` to avoid parent document reads for authorization.\n\n**QAPs (Rules are not Filters):** Secure `list` operations are supported by segregating data based on ownership (path-based). Each user can only list reservations under their own `/users/{userId}` path. For restaurant listings, all users can list all restaurants, but access to specific restaurant details is still controlled by restaurant-level security rules.\n\n**Denormalization:** The `restaurantId` is denormalized into the `MenuItem` and `Table` documents to maintain Authorization Independence. The `userId` is available inside the `Reservation` document to enforce that a `User` only has access to his own `Reservation` documents."
  }
}